id: P2-API-Service-Solve-Clear
phase: 2
layer: API
area: Service
action: Solve-Clear
target_file: backend/app/services/solve_service.py
test_file: backend/tests/test_solve_service.py
depends_on: ["P2-API-Service-Solve-Set"]
spec_refs:
  - "05"  # FastAPI設計
  - "04"  # APIコントラクト
  - "04a" # DTO定義
  - "04b" # API規約
  - "03a" # DDL
  - "01"  # ドメイン不変条件
estimated_loc: 30

specification:
  purpose: "解決済みコメント設定をクリアするサービスロジック実装"
  
  content_requirements:
    - section: "ClearSolveメソッド"
      items:
        - "clear_solved_comment メソッド"
        - "引数: user_id, thread_id"
        - "権限チェック（スレッド投稿者のみ）"
        - "解決状態の解除"
    
    - section: "バリデーション"
      items:
        - "スレッドが「質問」タイプであること"
        - "スレッド投稿者本人のみ実行可能"
        - "解決済みコメントが設定されていること"
        - "不適用（質問以外）の場合は 400 VALIDATION_ERROR（details.reason=NOT_APPLICABLE, field=thread.tags）"
    
    - section: "処理フロー"
      items:
        - "スレッド情報取得・権限チェック"
        - "解決済みコメントの存在確認"
        - "解決フラグのクリア"
        - "成功時は None（204 No Content）"

  output_format: "Python サービスメソッド"

constraints:
  - "厳密な権限チェック"
  - "データ整合性の保証"
  - "適切なエラーメッセージ"

test_specification:
  validation:
    - "質問スレッドで解決クリアできること"
    - "話題スレッドでエラーになること"
    - "スレッド投稿者以外でエラーになること"

definition_of_done:
  - "clear_solved_commentメソッドが実装されている"
  - "ビジネスルールが実装されている"
  - "テストが追加されている"