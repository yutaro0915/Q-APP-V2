# claim:
#   id: P2-API-Router-Reactions-Comment
#   assignee: claude_agent
#   start_at: 2025-08-09T06:39:23Z
#   note: ""
id: P2-API-Router-Reactions-Comment
phase: 2
layer: API
area: Router
action: Reactions-Comment
target_file: backend/app/routers/reactions.py
test_file: backend/tests/test_reactions_router.py
depends_on: ["P2-API-Service-Reactions-CommentUp", "P1-API-Auth-Bootstrap"]
spec_refs:
  - "04"   # APIコントラクト
  - "04a"  # DTO定義
  - "04b"  # API規約
  - "03a"  # DDL
  - "01"   # 不変条件
estimated_loc: 35

specification:
  purpose: "POST /comments/{id}/reactions エンドポイント実装（204固定、重複は409）"
  
  content_requirements:
    - section: "エンドポイント定義"
      items:
        - "POST /comments/{id}/reactions"
        - "認証必須（Depends(get_current_user)）"
        - "パスパラメータ: id（cmt_*）"
        - "リクエストボディ: ReactionRequestComment"
        - "レスポンス: 204 No Content"
    
    - section: "処理フロー"
      items:
        - "認証トークン検証"
        - "id 形式検証"
        - "kind による分岐（up のみ）"
        - "react_comment_up サービス呼び出し"
        - "204 No Content で返却"
    
    - section: "リアクション種別処理"
      items:
        - "up: react_comment_up サービス呼び出し"
        - "コメントは保存リアクション非対応"
        - "不正なtypeで400エラー"

  output_format: "Python FastAPIルーター"

constraints:
  - "べき等性の保証"
  - "適切なHTTPステータス"
  - "構造化ログ出力"

test_specification:
  validation:
    - "コメントいいねリアクションが動作すること（204）"
    - "重複リアクションで409エラー（CONFLICT）"
    - "不正なリアクション種別で400エラー"
    - "認証なしで401エラー"

definition_of_done:
  - "POSTエンドポイントが実装されている"
  - "リアクション制限が実装されている"
  - "テストが追加されている"
# done:
#   finished_at: 2025-08-09T06:47:32Z
#   result: GREEN
#   note: "Implemented POST /comments/{id}/reactions endpoint with authentication, validation, and error handling. TDD complete with comprehensive test coverage."