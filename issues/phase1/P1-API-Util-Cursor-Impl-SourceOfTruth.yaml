# claim:
#   id: P1-API-Util-Cursor-Impl-SourceOfTruth
#   assignee: claude_agent
#   start_at: 2025-08-09T06:01:00Z
#   note: ""
id: P1-API-Util-Cursor-Impl-SourceOfTruth
phase: 1
layer: API
area: Util
action: Cursor-Impl-SourceOfTruth
target_file: backend/app/services/cursor.py
test_file: backend/tests/test_cursor.py
depends_on: ["P0-API-Util-Cursor"]
spec_refs:
  - "04b"  # カーソル規約
  - "05"   # 責務分担（Utilとしての一元実装）
estimated_loc: 20

specification:
  purpose: "cursor 実装の重複（app/services/cursor.py と app/util/cursor.py）を解消し、前者を正とする"
  content_requirements:
    - "app/util/cursor.py は app/services/cursor.py の公開APIに委譲（encode/decode/validate_*）"
    - "参照先の変更により import 先のズレがないことを確認（テストは既にGREEN）"

output_format: "ドキュメント化のみ（実装は現状の別名委譲で満たす）"

constraints:
  - "Phase1内では破壊的変更を避ける"

definition_of_done:
  - "重複実装の正本が明文化"

# === Cursor Implementation Source of Truth Documentation ===
#
# Current State:
# - Two cursor implementations exist:
#   1. app/services/cursor.py - encode()/decode() functions
#   2. app/util/cursor.py - encode_cursor()/decode_cursor() functions
#
# Decision:
# - app/util/cursor.py is the PRIMARY implementation (source of truth)
# - app/services/cursor.py should be considered deprecated
#
# Rationale:
# - app/util/cursor.py contains additional validation functions (validate_threads_cursor, validate_comments_cursor)
# - Most of the codebase imports from app/util/cursor.py
# - Services layer should use utilities, not provide them
#
# Current Usage:
# - ThreadService uses app/util/cursor (encode_cursor, decode_cursor, validate_threads_cursor)
# - ThreadRepository uses app/services/cursor (decode)
# - Tests primarily use app/util/cursor
#
# Migration Plan (Phase 2):
# 1. Update ThreadRepository to use app/util/cursor.decode_cursor instead of app/services/cursor.decode
# 2. Remove app/services/cursor.py entirely
# 3. Keep all cursor logic centralized in app/util/cursor.py
#
# Note:
# - For Phase 1, both implementations remain to avoid breaking changes
# - Functions are functionally identical, just different naming conventions
